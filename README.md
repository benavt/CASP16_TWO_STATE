# CASP Data Processing

This repository contains scripts and utilities for processing, analyzing, and visualizing data for the CASP (Critical Assessment of Structure Prediction) assessment. The workflow includes processing scores, identifying missing data points, and generating plots and summary files.

## Directory Structure

```
CASP_DATA_PROCESSING/
├── DATA/              # Contains gathered data files (input for processing)
├── OUTPUT/            # Output CSVs and summary files generated by scripts
├── PLOTS/             # Generated plots and visualizations
├── LATEX_TABLES/      # LaTeX table files for publication
├── process_two_state_score.py    # Processes two-state scores for all targets
├── process_single_state_score.py # Processes single-state scores for specific targets
├── create_latex_tables.py       # Generates LaTeX tables for publication
└── group_number_name_correspondance.csv  # Group number to name mapping
```

## Prerequisites

- Python 3.7+
- Required Python packages:
  - pandas
  - matplotlib
  - adjustText
  - tqdm

Install dependencies with:
```bash
pip install pandas matplotlib adjustText tqdm
```

## Script Overview and Usage

### 1. `process_two_state_score.py`
**Purpose**: Processes the gathered data to compute two-state scores for each target and score type, generates summary CSVs in `OUTPUT/`, and creates scatter and bar plots in `PLOTS/`.

**Usage:**
```bash
python process_two_state_score.py
```

**What it does:**
- Automatically processes all targets and score types defined in `TARGET_SCORE_DICT`
- Computes two-state scores by combining the best scores from different model/version combinations
- Generates scatter plots comparing V1 vs V2 reference states
- Creates stacked bar charts showing combined scores
- Saves detailed CSV outputs with all scoring information
- Handles special cases for different targets (M1228, M1239, R1203, T1214, T1228, T1239, T1249)

**Targets and Score Types Processed:**
- **M1228**: BestDockQ, GDT_TS, GlobDockQ, GlobalLDDT, TMscore
- **M1239**: BestDockQ, GDT_TS, GlobDockQ, GlobalLDDT, TMscore
- **R1203**: GDT_TS, GlobalLDDT, Composite_Score_4, TMscore
- **T1214**: GDT_TS, GlobalLDDT, TMscore, Composite_Score_4
- **T1228**: GDT_TS, GlobalLDDT, TMscore
- **T1239**: GDT_TS, GlobalLDDT, TMscore
- **T1249**: AvgDockQ, GlobalLDDT, GDT_TS, TMscore

### 2. `process_single_state_score.py`
**Purpose**: Processes single-state scores for targets that only have one reference state (currently T1214).

**Usage:**
```bash
python process_single_state_score.py
```

**What it does:**
- Processes targets that don't have V1/V2 reference state comparisons
- Generates single-state scoring analysis
- Creates appropriate visualizations for single-state data
- Currently configured for T1214 with GDT_TS, GlobalLDDT, TMscore, and Composite_Score_4

### 3. `create_latex_tables.py`
**Purpose**: Generates LaTeX table files from the processed CSV outputs for publication purposes.

**Usage:**
```bash
python create_latex_tables.py
```

**What it does:**
- Reads all CSV files from the `OUTPUT/` directory
- Converts them to properly formatted LaTeX tables
- Handles special formatting for publication (decimal places, underscores, etc.)
- Creates a special T1214 Sigma4 score table
- Saves all tables to the `LATEX_TABLES/` directory

## Complete Workflow

1. **Process Two-State Scores:**
   ```bash
   python process_two_state_score.py
   ```

2. **Process Single-State Scores (if applicable):**
   ```bash
   python process_single_state_score.py
   ```

3. **Generate LaTeX Tables:**
   ```bash
   python create_latex_tables.py
   ```

## Output Files

### CSV Outputs (`OUTPUT/` directory)
Each output CSV file contains detailed scoring information with columns:
- **Group**: The submission group identifier (e.g., TS314)
- **Group_Name**: Human-readable group name
- **Combined_Score**: The sum of the two best scores for the group
- **Best_v1_ref**: The best score using a v1 reference
- **Best_v2_ref**: The best score using a v2 reference
- **V1_Model_For_Combined_Score**: Model identifier for the V1 score
- **V2_Model_For_Combined_Score**: Model identifier for the V2 score
- **Best_Score**: The highest score among all combinations
- **Best_Source**: Which combination produced the best score
- **v1_v1_Score, v1_v2_Score, v2_v1_Score, v2_v2_Score**: Individual scores for each combination
- **v1_v1_ModelNumber, v1_v2_ModelNumber, v2_v1_ModelNumber, v2_v2_ModelNumber**: Model numbers for each score

### Plots (`PLOTS/` directory)
- **Scatter plots**: Comparing V1 vs V2 reference states
- **Stacked bar charts**: Horizontal and vertical versions with and without special highlighting
- **Special features**: AF3 baseline highlighting, inset zoom regions for specific targets

### LaTeX Tables (`LATEX_TABLES/` directory)
- Publication-ready LaTeX tables for all processed data
- Proper formatting and escaping for academic publication
- Special T1214 Sigma4 score table

## Special Features

- **AF3 Baseline Highlighting**: Special highlighting for group 304 (AF3) in relevant plots
- **Inset Zoom Regions**: Detailed zoom views for specific target/score combinations
- **Dynamic Plot Sizing**: Automatic adjustment of plot dimensions based on number of groups
- **Group Name Mapping**: Automatic conversion of group numbers to human-readable names
- **Error Handling**: Robust error handling for missing data or processing issues

## Troubleshooting

- **Missing Data Files**: Ensure data files exist in the `DATA/` directory
- **Missing Dependencies**: Install required Python packages using the pip command above
- **File Path Issues**: Ensure the script is run from the `CASP_DATA_PROCESSING/` directory
- **Memory Issues**: For large datasets, consider processing targets individually

## License

This project is intended for research and assessment purposes. Please contact the repository owner for licensing details.
